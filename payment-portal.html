<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Himaayah ‚Äî Payment Portal</title>

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    :root{
      --regal: #094570;
      --pastel: #85CCFF;
      --white: #FFFFFF;
    }
    body { font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; background: linear-gradient(180deg,var(--pastel)10%, #f8fbff 60%); }
    .brand-btn { background: var(--regal); color: var(--white); }
    .brand-outline { border: 2px solid var(--regal); color: var(--regal); }
    .card { background: var(--white); border-radius: 14px; box-shadow: 0 10px 30px rgba(9,69,112,0.08); }
    .step { transition: all .35s ease; }
    .step-hidden { display:none; opacity:0; transform: translateY(8px); }
    .step-visible { display:block; opacity:1; transform: translateY(0); }
    .accent { color: var(--regal); }
    .accent-bg { background: linear-gradient(90deg, var(--regal), var(--pastel)); color: var(--white); }
  </style>
</head>
<body class="min-h-screen flex items-center justify-center p-6">

  <main class="w-full max-w-2xl card p-6">
    <header class="flex items-center justify-between mb-6">
      <div class="flex items-center gap-4">
        <div class="w-12 h-12 rounded-md flex items-center justify-center" style="background:var(--regal);color:var(--white);font-weight:700">H</div>
        <div>
          <h1 class="text-xl font-bold accent">Himaayah Payment Portal</h1>
          <p class="text-sm text-gray-600">Secure payments ‚Äî Admission, Term, & Exam fees</p>
        </div>
      </div>
      <div class="text-sm text-gray-600">3-step checkout ‚Ä¢ local save</div>
    </header>

    <!-- Progress -->
    <div class="flex items-center gap-3 mb-6">
      <div id="prog1" class="flex-1 h-2 rounded bg-[#e6eef8] relative overflow-hidden">
        <div class="h-2 bg-[var(--regal)] w-0" style="transition:width .35s" id="progBar1"></div>
      </div>
      <div id="prog2" class="flex-1 h-2 rounded bg-[#e6eef8] relative overflow-hidden">
        <div class="h-2 bg-[var(--regal)] w-0" style="transition:width .35s" id="progBar2"></div>
      </div>
      <div id="prog3" class="flex-1 h-2 rounded bg-[#e6eef8] relative overflow-hidden">
        <div class="h-2 bg-[var(--regal)] w-0" style="transition:width .35s" id="progBar3"></div>
      </div>
    </div>

    <!-- Steps -->
    <section id="step-1" class="step step-visible">
      <h2 class="text-lg font-semibold accent mb-2">Step 1 ‚Äî Choose payment purpose</h2>
      <p class="text-sm text-gray-600 mb-4">Select what you're paying for.</p>

      <label class="block mb-4">
        <select id="purpose" class="w-full border rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-[var(--regal)]">
          <option value="">-- Select Purpose --</option>
          <option value="Admission Fee">Admission / Registration Fee</option>
          <option value="Term Fee">Term Fees</option>
          <option value="Exam Fee">Exam Fees</option>
        </select>
      </label>

      <div class="flex justify-between items-center gap-3">
        <button id="s1Next" class="brand-btn px-5 py-2 rounded-lg">Next ‚Äî Details</button>
        <button id="saveDraft1" class="brand-outline px-4 py-2 rounded-lg">Save Draft</button>
      </div>
    </section>

    <section id="step-2" class="step step-hidden">
      <h2 class="text-lg font-semibold accent mb-2">Step 2 ‚Äî Student details</h2>
      <p class="text-sm text-gray-600 mb-4">We‚Äôll save these locally until you're ready to pay.</p>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
        <input id="name" type="text" placeholder="Full name" class="border rounded-lg p-3 focus:ring-2 focus:ring-[var(--regal)]" />
        <input id="email" type="email" placeholder="Email address" class="border rounded-lg p-3 focus:ring-2 focus:ring-[var(--regal)]" />
        <input id="phone" type="tel" placeholder="Phone number" class="border rounded-lg p-3 focus:ring-2 focus:ring-[var(--regal)]" />
        <input id="studentId" type="text" placeholder="Student ID" class="border rounded-lg p-3 focus:ring-2 focus:ring-[var(--regal)]" />
      </div>

      <div class="flex justify-between items-center gap-3 mt-4">
        <button id="s2Back" class="px-4 py-2 rounded-lg border">Back</button>
        <div class="flex gap-2">
          <button id="saveDraft2" class="brand-outline px-4 py-2 rounded-lg">Save Draft</button>
          <button id="s2Next" class="brand-btn px-5 py-2 rounded-lg">Next ‚Äî Pay</button>
        </div>
      </div>
    </section>

    <section id="step-3" class="step step-hidden">
      <h2 class="text-lg font-semibold accent mb-2">Step 3 ‚Äî Choose payment method</h2>
      <p class="text-sm text-gray-600 mb-4">Pick any method. For Bank/USSD we'll show instructions; Paystack & Flutterwave are simulated here.</p>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-3 mb-4">
        <button class="method-btn border rounded-lg p-4 text-left flex items-center gap-3" data-method="Paystack">
          <div class="w-10 h-10 rounded bg-[var(--regal)] flex items-center justify-center text-white">PS</div>
          <div>
            <div class="font-semibold">Paystack</div>
            <div class="text-xs text-gray-500">Card & mobile payments (simulated)</div>
          </div>
        </button>

        <button class="method-btn border rounded-lg p-4 text-left flex items-center gap-3" data-method="Flutterwave">
          <div class="w-10 h-10 rounded bg-[var(--pastel)] flex items-center justify-center text-white">FW</div>
          <div>
            <div class="font-semibold">Flutterwave</div>
            <div class="text-xs text-gray-500">Card & mobile payments (simulated)</div>
          </div>
        </button>

        <button class="method-btn border rounded-lg p-4 text-left flex items-center gap-3" data-method="Bank Transfer">
          <div class="w-10 h-10 rounded bg-gray-200 flex items-center justify-center text-[var(--regal)]">üè¶</div>
          <div>
            <div class="font-semibold">Bank Transfer</div>
            <div class="text-xs text-gray-500">Get bank details & reference</div>
          </div>
        </button>

        <button class="method-btn border rounded-lg p-4 text-left flex items-center gap-3" data-method="USSD">
          <div class="w-10 h-10 rounded bg-gray-200 flex items-center justify-center text-[var(--regal)]">üì±</div>
          <div>
            <div class="font-semibold">USSD</div>
            <div class="text-xs text-gray-500">Pay via your bank‚Äôs USSD code</div>
          </div>
        </button>
      </div>

      <div id="payInstructions" class="hidden p-4 rounded border bg-[#fbfdff] text-sm text-gray-700"></div>

      <div class="flex justify-between items-center gap-3 mt-4">
        <button id="s3Back" class="px-4 py-2 rounded-lg border">Back</button>
        <div class="flex gap-2">
          <button id="saveDraft3" class="brand-outline px-4 py-2 rounded-lg">Save Draft</button>
          <button id="confirmPay" class="brand-btn px-5 py-2 rounded-lg">Confirm & Pay</button>
        </div>
      </div>
    </section>

    <!-- Confirmation -->
    <section id="confirmation" class="step step-hidden text-center p-4">
      <div class="p-4 rounded-lg border bg-[#f0fff7]">
        <h3 class="text-xl font-bold text-green-700 mb-2">Payment Recorded ‚úÖ</h3>
        <p class="text-sm text-gray-600 mb-3">A local record has been saved and a receipt is available to download.</p>
        <div class="flex justify-center gap-3">
          <button id="downloadPdf" class="brand-btn px-4 py-2 rounded-lg">Download Receipt (PDF)</button>
          <button id="viewRecord" class="border px-4 py-2 rounded-lg">View Local Record</button>
        </div>
      </div>
    </section>

    <!-- Local record preview (hidden by default) -->
    <section id="recordView" class="step step-hidden p-3 mt-4 border rounded">
      <h4 class="font-semibold accent mb-2">Local Payment Record</h4>
      <pre id="recordJSON" class="text-xs text-gray-700 bg-[#f8fafc] p-3 rounded overflow-auto"></pre>
      <div class="flex justify-end mt-3">
        <button id="closeRecord" class="px-3 py-2 rounded border">Close</button>
      </div>
    </section>

  </main>

  <!-- jsPDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <script>
    // Elements
    const step1 = document.getElementById('step-1');
    const step2 = document.getElementById('step-2');
    const step3 = document.getElementById('step-3');
    const confirmation = document.getElementById('confirmation');
    const recordView = document.getElementById('recordView');
    const recordJSON = document.getElementById('recordJSON');
    const payInstructions = document.getElementById('payInstructions');

    const progBar1 = document.getElementById('progBar1');
    const progBar2 = document.getElementById('progBar2');
    const progBar3 = document.getElementById('progBar3');

    const purposeEl = document.getElementById('purpose');
    const nameEl = document.getElementById('name');
    const emailEl = document.getElementById('email');
    const phoneEl = document.getElementById('phone');
    const studentIdEl = document.getElementById('studentId');

    // state
    let draft = {}; // will hold current draft
    let selectedMethod = null;

    // helpers
    function show(el){
      el.classList.remove('step-hidden'); el.classList.add('step-visible');
    }
    function hide(el){
      el.classList.remove('step-visible'); el.classList.add('step-hidden');
    }
    function setProgress(step){
      progBar1.style.width = step >= 1 ? '100%' : '0%';
      progBar2.style.width = step >= 2 ? '100%' : '0%';
      progBar3.style.width = step >= 3 ? '100%' : '0%';
    }

    // initial
    setProgress(1);

    // navigation buttons
    document.getElementById('s1Next').addEventListener('click', () => {
      if(!purposeEl.value) return alert('Select a payment purpose.');
      draft.purpose = purposeEl.value;
      show(step2); hide(step1); hide(step3); hide(confirmation); hide(recordView);
      setProgress(2);
      // try to load previous draft for student id
      loadDraftToForm();
    });

    document.getElementById('s2Back').addEventListener('click', () => {
      show(step1); hide(step2); hide(step3); hide(confirmation); hide(recordView);
      setProgress(1);
    });

    document.getElementById('s2Next').addEventListener('click', () => {
      // validate details
      if(!nameEl.value || !emailEl.value || !studentIdEl.value) return alert('Please complete name, email and student ID.');
      draft.name = nameEl.value; draft.email = emailEl.value; draft.phone = phoneEl.value; draft.studentId = studentIdEl.value;
      show(step3); hide(step1); hide(step2); hide(confirmation); hide(recordView);
      setProgress(3);
    });

    document.getElementById('s3Back').addEventListener('click', () => {
      show(step2); hide(step1); hide(step3); hide(confirmation); hide(recordView);
      setProgress(2);
    });

    // save draft buttons
    document.getElementById('saveDraft1').addEventListener('click', () => {
      draft.purpose = purposeEl.value || draft.purpose;
      localStorage.setItem('himaayah_payment_draft', JSON.stringify(draft));
      alert('Draft saved locally.');
    });
    document.getElementById('saveDraft2').addEventListener('click', () => {
      draft.name = nameEl.value || draft.name;
      draft.email = emailEl.value || draft.email;
      draft.phone = phoneEl.value || draft.phone;
      draft.studentId = studentIdEl.value || draft.studentId;
      localStorage.setItem('himaayah_payment_draft', JSON.stringify(draft));
      alert('Draft saved locally.');
    });
    document.getElementById('saveDraft3').addEventListener('click', () => {
      if(!selectedMethod) return alert('Pick a payment method first.');
      localStorage.setItem('himaayah_payment_draft', JSON.stringify(draft));
      alert('Draft saved locally.');
    });

    // method buttons
    document.querySelectorAll('.method-btn').forEach(btn => {
      btn.addEventListener('click', (e) => {
        document.querySelectorAll('.method-btn').forEach(b => b.classList.remove('ring-2','ring-[var(--regal)]'));
        btn.classList.add('ring-2','ring-[var(--regal)]');
        selectedMethod = btn.dataset.method;
        showMethodInstructions(selectedMethod);
      });
    });

    function showMethodInstructions(method){
      payInstructions.classList.remove('hidden');
      payInstructions.innerHTML = '';
      if(method === 'Paystack' || method === 'Flutterwave'){
        payInstructions.innerHTML = `<strong>${method} (Simulated)</strong>
          <p class="mt-2 text-sm text-gray-600">You will be redirected to ${method} to complete payment. (In this demo it's simulated.)</p>`;
      } else if(method === 'Bank Transfer'){
        payInstructions.innerHTML = `<strong>Bank Transfer Instructions</strong>
          <p class="mt-2 text-sm text-gray-700">Account: Himaayah Madrasah<br>Bank: Example Bank<br>Account No: 0123456789<br>Reference: PAY-${Date.now().toString().slice(-6)}</p>`;
      } else if(method === 'USSD'){
        payInstructions.innerHTML = `<strong>USSD Instructions</strong>
          <p class="mt-2 text-sm text-gray-700">Dial: *123*45*${Math.floor(Math.random()*9000)+1000}# and follow prompts. Use reference: USSD-${Date.now().toString().slice(-6)}</p>`;
      }
    }

    // confirm & pay (simulated)
    document.getElementById('confirmPay').addEventListener('click', () => {
      if(!selectedMethod) return alert('Select a payment method');
      draft.method = selectedMethod;
      draft.timestamp = new Date().toISOString();
      // create a record key per student id
      const key = 'himaayah_payment_' + draft.studentId;
      const record = { id: 'pay_' + Math.random().toString(36).slice(2,9), purpose: draft.purpose, name: draft.name, email: draft.email, phone: draft.phone, studentId: draft.studentId, method: draft.method, date: new Date().toLocaleString(), status: 'SUCCESS' };
      // save to localStorage under single key list
      const payments = JSON.parse(localStorage.getItem('himaayah_payments') || '[]');
      payments.push(record);
      localStorage.setItem('himaayah_payments', JSON.stringify(payments));
      // also individual key
      localStorage.setItem(key, JSON.stringify(record));
      // set lastRecord for view
      localStorage.setItem('himaayah_last_payment', JSON.stringify(record));

      // show confirmation
      hide(step1); hide(step2); hide(step3);
      show(confirmation);
      hide(recordView);
      setProgress(3);
    });

    // download receipt
    document.getElementById('downloadPdf').addEventListener('click', () => {
      const rec = JSON.parse(localStorage.getItem('himaayah_last_payment') || '{}');
      if(!rec.id) return alert('No payment found.');
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      doc.setFontSize(16);
      doc.setTextColor(9,69,112);
      doc.text('Himaayah Institute of Arabic & Islamic Studies', 14, 20);
      doc.setFontSize(12);
      doc.setTextColor(0,0,0);
      doc.text('Payment Receipt', 14, 30);
      doc.setFontSize(10);
      doc.text(`Name: ${rec.name}`, 14, 42);
      doc.text(`Student ID: ${rec.studentId}`, 14, 50);
      doc.text(`Email: ${rec.email}`, 14, 58);
      doc.text(`Phone: ${rec.phone || '-'}`, 14, 66);
      doc.text(`Purpose: ${rec.purpose}`, 14, 74);
      doc.text(`Method: ${rec.method}`, 14, 82);
      doc.text(`Date: ${rec.date}`, 14, 90);
      doc.text(`Status: ${rec.status}`, 14, 98);
      doc.setFontSize(9);
      doc.text('Powered by Himaayah', 14, 180);
      doc.save(`Himaayah_Receipt_${rec.studentId}.pdf`);
    });

    // view record
    document.getElementById('viewRecord').addEventListener('click', () => {
      const payments = JSON.parse(localStorage.getItem('himaayah_payments') || '[]');
      recordJSON.textContent = JSON.stringify(payments.slice(-10).reverse(), null, 2);
      show(recordView); hide(step1); hide(step2); hide(step3); hide(confirmation);
    });

    document.getElementById('closeRecord').addEventListener('click', () => {
      hide(recordView);
      show(confirmation);
    });

    // load draft into form if present
    function loadDraftToForm(){
      const raw = localStorage.getItem('himaayah_payment_draft');
      if(!raw) return;
      try {
        const d = JSON.parse(raw);
        if(d.purpose) purposeEl.value = d.purpose;
        if(d.name) nameEl.value = d.name;
        if(d.email) emailEl.value = d.email;
        if(d.phone) phoneEl.value = d.phone;
        if(d.studentId) studentIdEl.value = d.studentId;
      } catch(e){}
    }

    // restore draft on page load if exists
    window.addEventListener('load', () => {
      const d = localStorage.getItem('himaayah_payment_draft');
      if(d) draft = JSON.parse(d);
      loadDraftToForm();
    });

    // quick keyboard accessibility: allow Enter on selected method if focused
    document.addEventListener('keyup', (e) => {
      if(e.key === 'Enter'){
        // if on step3 and a method is selected, confirm
        if(!document.getElementById('step-3').classList.contains('step-hidden') && selectedMethod){
          document.getElementById('confirmPay').click();
        }
      }
    });
  </script>
</body>
</html>
