<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Payment Portal | Himaayah Institute of Arabic and Islamic Studies</title>

  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    :root{
      --regal:#094570;
      --pastel:#85CCFF;
      --white:#FFFFFF;
    }
    html{scroll-behavior:smooth;}

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(14px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .animate-fadeIn { animation: fadeIn .7s ease-out; }

    .card{
      border:1px solid rgba(9,69,112,0.14);
      border-radius:1.25rem;
      background:var(--white);
      box-shadow: 0 14px 30px rgba(9,69,112,0.10);
    }

    .muted{ color: rgba(9,69,112,0.78); }
    .muted-2{ color: rgba(9,69,112,0.65); }

    .step{ transition: all .25s ease; }
    .step-hidden{ display:none; opacity:0; transform: translateY(8px); }
    .step-visible{ display:block; opacity:1; transform: translateY(0); }
  </style>
</head>

<body class="bg-white min-h-screen flex flex-col">

  <!-- HEADER -->
  <header class="bg-[var(--regal)] text-white fixed inset-x-0 top-0 z-50">
    <div class="mx-auto max-w-7xl px-4 sm:px-6">
      <div class="flex h-16 items-center justify-between">
        <a href="index.html" class="flex items-center gap-3 min-w-0">
          <object
            data="assets/images/himaayah-icon.svg"
            type="image/svg+xml"
            class="h-10 w-10 shrink-0"
            style="color: var(--pastel);"
            aria-label="Himaayah Icon"
          ></object>
          <div class="min-w-0">
            <div class="font-extrabold truncate text-lg sm:text-xl">HIAIS</div>
          </div>
        </a>

        <nav class="hidden md:flex items-center gap-6 text-sm font-medium">
          <a href="index.html" class="hover:text-[var(--pastel)] transition">Home</a>
          <a href="about.html" class="hover:text-[var(--pastel)] transition">About</a>
          <a href="curriculum.html" class="hover:text-[var(--pastel)] transition">Curriculum</a>
          <a href="login.html" class="hover:text-[var(--pastel)] transition">Login</a>
          <a href="payment-portal.html" class="text-[var(--pastel)] underline underline-offset-4 font-semibold">Register</a>
          <a href="blogpost.html" class="hover:text-[var(--pastel)] transition">Blog</a>
          <a href="contact.html" class="hover:text-[var(--pastel)] transition">Contact</a>
        </nav>

        <button
          id="menuBtn"
          class="md:hidden inline-flex items-center justify-center rounded-xl border border-white/20 px-3 py-2 text-sm hover:bg-white/10"
          aria-expanded="false"
          aria-controls="mobileMenu"
        >
          Menu
        </button>
      </div>

      <div id="mobileMenu" class="md:hidden hidden pb-4">
        <nav class="grid gap-2 rounded-2xl border border-white/10 bg-white/5 p-3 text-sm">
          <a href="index.html" class="rounded-xl px-3 py-2 hover:bg-white/10">Home</a>
          <a href="about.html" class="rounded-xl px-3 py-2 hover:bg-white/10">About</a>
          <a href="curriculum.html" class="rounded-xl px-3 py-2 hover:bg-white/10">Curriculum</a>
          <a href="login.html" class="rounded-xl px-3 py-2 hover:bg-white/10">Login</a>
          <a href="payment-portal.html" class="rounded-xl px-3 py-2 bg-white/10 text-[var(--pastel)] font-semibold">Register</a>
          <a href="blogpost.html" class="rounded-xl px-3 py-2 hover:bg-white/10">Blog</a>
          <a href="contact.html" class="rounded-xl px-3 py-2 hover:bg-white/10">Contact</a>
        </nav>
      </div>
    </div>
  </header>

  <main class="flex-1 pt-24 sm:pt-28 pb-12 px-4">

    <!-- Title -->
    <section class="max-w-3xl mx-auto text-center animate-fadeIn">
      <h1 class="text-2xl sm:text-3xl font-extrabold text-[var(--regal)]">Payment Portal</h1>
      <div class="mx-auto mt-4 h-1 w-14 rounded-full bg-[var(--pastel)]"></div>
      <p class="mt-4 text-sm sm:text-base muted">
        Payments are accepted via Bank Transfer or USSD only.
      </p>
    </section>

    <section class="max-w-2xl mx-auto mt-10 animate-fadeIn">
      <div class="card p-6 sm:p-8">

        <!-- Progress -->
        <div class="flex items-center gap-3 mb-7">
          <div class="flex-1 h-2 rounded-full" style="background: rgba(9,69,112,0.12);">
            <div id="progBar1" class="h-2 rounded-full" style="background: var(--regal); width: 0%; transition: width .25s;"></div>
          </div>
          <div class="flex-1 h-2 rounded-full" style="background: rgba(9,69,112,0.12);">
            <div id="progBar2" class="h-2 rounded-full" style="background: var(--regal); width: 0%; transition: width .25s;"></div>
          </div>
          <div class="flex-1 h-2 rounded-full" style="background: rgba(9,69,112,0.12);">
            <div id="progBar3" class="h-2 rounded-full" style="background: var(--regal); width: 0%; transition: width .25s;"></div>
          </div>
        </div>

        <!-- STEP 1 -->
        <section id="step-1" class="step step-visible">
          <h2 class="text-lg font-extrabold text-[var(--regal)] mb-2">Step 1. Payment Purpose</h2>
          <p class="text-sm muted mb-4">Choose what you are paying for.</p>

          <select
            id="purpose"
            class="w-full rounded-xl px-4 py-3 border outline-none bg-white"
            style="border-color: rgba(9,69,112,0.18);"
          >
            <option value="">Select Purpose</option>
            <option value="Admission / Registration Fee">Admission / Registration Fee</option>
            <option value="Term Fees">Term Fees</option>
            <option value="Exam Fees">Exam Fees</option>
          </select>

          <div class="mt-5 flex flex-col sm:flex-row gap-3 sm:items-center sm:justify-between">
            <button id="s1Next" class="w-full sm:w-auto rounded-full px-6 py-3 font-semibold text-white"
              style="background: var(--regal);">
              Next
            </button>
            <button id="saveDraft1" class="w-full sm:w-auto rounded-full px-6 py-3 font-semibold border"
              style="border-color: rgba(9,69,112,0.18); color: var(--regal);">
              Save Draft
            </button>
          </div>
        </section>

        <!-- STEP 2 -->
        <section id="step-2" class="step step-hidden">
          <h2 class="text-lg font-extrabold text-[var(--regal)] mb-2">Step 2. Student Details</h2>
          <p class="text-sm muted mb-4">
            Your email will be your username. Student ID will be issued after payment confirmation.
          </p>

          <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
            <input id="name" type="text" placeholder="Full name"
              class="rounded-xl px-4 py-3 border outline-none"
              style="border-color: rgba(9,69,112,0.18);" />
            <input id="email" type="email" placeholder="Email address (required)"
              class="rounded-xl px-4 py-3 border outline-none"
              style="border-color: rgba(9,69,112,0.18);" />
            <input id="phone" type="tel" placeholder="Phone number (optional)"
              class="rounded-xl px-4 py-3 border outline-none"
              style="border-color: rgba(9,69,112,0.18);" />
            <input id="note" type="text" placeholder="Class/Level (optional). e.g., Awwal Ibtidaaiyyah"
              class="rounded-xl px-4 py-3 border outline-none"
              style="border-color: rgba(9,69,112,0.18);" />
          </div>

          <div class="mt-5 flex flex-col sm:flex-row gap-3 sm:items-center sm:justify-between">
            <button id="s2Back" class="w-full sm:w-auto rounded-full px-6 py-3 font-semibold border"
              style="border-color: rgba(9,69,112,0.18); color: var(--regal);">
              Back
            </button>

            <div class="flex flex-col sm:flex-row gap-3 w-full sm:w-auto">
              <button id="saveDraft2" class="w-full sm:w-auto rounded-full px-6 py-3 font-semibold border"
                style="border-color: rgba(9,69,112,0.18); color: var(--regal);">
                Save Draft
              </button>
              <button id="s2Next" class="w-full sm:w-auto rounded-full px-6 py-3 font-semibold text-white"
                style="background: var(--regal);">
                Next
              </button>
            </div>
          </div>
        </section>

        <!-- STEP 3 -->
        <section id="step-3" class="step step-hidden">
          <h2 class="text-lg font-extrabold text-[var(--regal)] mb-2">Step 3. Pay and Submit</h2>
          <p class="text-sm muted mb-5">
            Use Bank Transfer or USSD. Then tap “I have paid” to submit your payment claim for confirmation.
          </p>

          <!-- Payment details block -->
          <div class="rounded-2xl border p-5"
            style="border-color: rgba(9,69,112,0.14);">
            <div class="flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3">
              <div>
                <div class="text-sm font-extrabold text-[var(--regal)]">Payment Account</div>
                <div class="mt-2 text-sm muted">
                  Account Number: <span class="font-semibold text-[var(--regal)]">9064540675</span><br/>
                  Bank: <span class="font-semibold text-[var(--regal)]">OPay</span><br/>
                  Account Name: <span class="font-semibold text-[var(--regal)]">Yusuf Abdulsamad Olohuntosin</span>
                </div>
              </div>

              <button
                id="copyAccount"
                class="w-full sm:w-auto rounded-full px-5 py-2 font-semibold border"
                style="border-color: rgba(9,69,112,0.18); color: var(--regal);"
                type="button"
              >
                Copy Details
              </button>
            </div>

            <div class="mt-4 text-xs muted-2">
              Tip: Use your email or full name as the transfer narration if possible.
            </div>
          </div>

          <!-- Optional: Proof reference -->
          <div class="mt-4">
            <label class="block text-sm font-semibold text-[var(--regal)] mb-1">Payment reference (optional)</label>
            <input
              id="payRef"
              type="text"
              placeholder="e.g., OPay receipt ref or USSD ref (optional)"
              class="w-full rounded-xl px-4 py-3 border outline-none bg-white"
              style="border-color: rgba(9,69,112,0.18);"
            />
            <p class="mt-2 text-xs muted-2">
              This is not automatic verification. It helps your admin confirm faster.
            </p>
          </div>

          <div class="mt-5 flex flex-col sm:flex-row gap-3 sm:items-center sm:justify-between">
            <button id="s3Back" class="w-full sm:w-auto rounded-full px-6 py-3 font-semibold border"
              style="border-color: rgba(9,69,112,0.18); color: var(--regal);">
              Back
            </button>

            <div class="flex flex-col sm:flex-row gap-3 w-full sm:w-auto">
              <button id="saveDraft3" class="w-full sm:w-auto rounded-full px-6 py-3 font-semibold border"
                style="border-color: rgba(9,69,112,0.18); color: var(--regal);">
                Save Draft
              </button>
              <button id="confirmPaid" class="w-full sm:w-auto rounded-full px-6 py-3 font-semibold text-white"
                style="background: var(--regal);">
                I have paid
              </button>
            </div>
          </div>
        </section>

        <!-- Confirmation -->
        <section id="confirmation" class="step step-hidden text-center">
          <div class="rounded-2xl border p-5"
            style="border-color: rgba(9,69,112,0.14);">
            <h3 class="text-xl font-extrabold text-[var(--regal)]">Submission Received</h3>
            <p id="confirmMsg" class="mt-2 text-sm muted">
              JazaakAllahu khayran. Your payment claim has been received. Your Student ID will be issued after confirmation.
            </p>

            <div class="mt-5 rounded-2xl border p-5 text-left"
              style="border-color: rgba(9,69,112,0.14);">
              <div class="text-sm font-extrabold text-[var(--regal)]">Submission Details</div>

              <div class="mt-3 text-sm muted">
                Name:
                <div class="mt-1 font-semibold text-[var(--regal)]" id="confName">-</div>
              </div>

              <div class="mt-4 text-sm muted">
                Email:
                <div class="mt-1 font-semibold text-[var(--regal)]" id="confEmail">-</div>
              </div>

              <div class="mt-4 text-sm muted">
                Purpose:
                <div class="mt-1 font-semibold text-[var(--regal)]" id="confPurpose">-</div>
              </div>

              <div class="mt-4 text-sm muted">
                Payment reference:
                <div class="mt-1 font-semibold text-[var(--regal)]" id="confPayRef">-</div>
              </div>

              <div class="mt-5 text-xs muted-2">
                Next: If you already paid, send proof on WhatsApp for faster confirmation.
              </div>

              <div class="mt-5 flex flex-col sm:flex-row gap-3">
                <a
                  id="whatsappProof"
                  href="#"
                  target="_blank"
                  rel="noopener"
                  class="w-full sm:w-auto text-center rounded-full px-6 py-3 font-semibold text-white"
                  style="background: var(--regal);"
                >
                  Send payment proof on WhatsApp
                </a>

                <a
                  id="goLogin"
                  href="login.html"
                  class="w-full sm:w-auto text-center rounded-full px-6 py-3 font-semibold border"
                  style="border-color: rgba(9,69,112,0.18); color: var(--regal);"
                >
                  Go to Login
                </a>

                <button
                  id="copyDetails"
                  type="button"
                  class="w-full sm:w-auto rounded-full px-6 py-3 font-semibold border"
                  style="border-color: rgba(9,69,112,0.18); color: var(--regal);"
                >
                  Copy details
                </button>
              </div>
            </div>

            <div class="mt-5 flex flex-col sm:flex-row justify-center gap-3">
              <button id="viewRecord" class="rounded-full px-6 py-3 font-semibold border"
                style="border-color: rgba(9,69,112,0.18); color: var(--regal);">
                View Local Record
              </button>
            </div>
          </div>
        </section>

        <!-- Local record preview -->
        <section id="recordView" class="step step-hidden mt-5 rounded-2xl border p-4"
          style="border-color: rgba(9,69,112,0.14);">
          <h4 class="font-extrabold text-[var(--regal)] mb-2">Local Records (latest 10)</h4>
          <pre id="recordJSON" class="text-xs rounded-2xl p-4 overflow-auto"
            style="background: rgba(133,204,255,0.10); color: rgba(9,69,112,0.82);"></pre>
          <div class="flex justify-end mt-3">
            <button id="closeRecord" class="rounded-full px-5 py-2 font-semibold border"
              style="border-color: rgba(9,69,112,0.18); color: var(--regal);">
              Close
            </button>
          </div>
        </section>

      </div>
    </section>

  </main>

  <!-- Minimal Footer -->
  <footer class="py-8 text-center">
    <p class="text-sm font-medium text-[#094570]">
      © 2026 Himaayah Institute of Arabic and Islamic Studies. All rights reserved.
    </p>
    <p class="mt-1 text-xs" style="color: rgba(9,69,112,0.65);">
      Student Portal
    </p>
  </footer>

  <script>
    // =============================
    // CONFIG
    // =============================
    // Admin WhatsApp number (international format, no +). Replace if needed.
    const ADMIN_WHATSAPP_NUMBER = "2347080152258";

    // Optional: If you later connect a Google Form, paste endpoint + entry IDs here.
    // Leave as null to skip sending.
    const GOOGLE_FORM_ENDPOINT = null; // e.g. "https://docs.google.com/forms/d/e/FORM_ID/formResponse"
    const ENTRY = {
      purpose: "entry.1111111111",
      name: "entry.2222222222",
      email: "entry.3333333333",
      phone: "entry.4444444444",
      note: "entry.5555555555",
      payRef: "entry.6666666666"
    };

    // =============================
    // NAV (mobile)
    // =============================
    const menuBtn = document.getElementById('menuBtn');
    const mobileMenu = document.getElementById('mobileMenu');
    menuBtn?.addEventListener('click', () => {
      const isOpen = !mobileMenu.classList.contains('hidden');
      mobileMenu.classList.toggle('hidden');
      menuBtn.setAttribute('aria-expanded', String(!isOpen));
      menuBtn.textContent = isOpen ? 'Menu' : 'Close';
    });

    // =============================
    // STEP FLOW
    // =============================
    const step1 = document.getElementById('step-1');
    const step2 = document.getElementById('step-2');
    const step3 = document.getElementById('step-3');
    const confirmation = document.getElementById('confirmation');
    const recordView = document.getElementById('recordView');
    const recordJSON = document.getElementById('recordJSON');

    const progBar1 = document.getElementById('progBar1');
    const progBar2 = document.getElementById('progBar2');
    const progBar3 = document.getElementById('progBar3');

    const purposeEl = document.getElementById('purpose');
    const nameEl = document.getElementById('name');
    const emailEl = document.getElementById('email');
    const phoneEl = document.getElementById('phone');
    const noteEl = document.getElementById('note');
    const payRefEl = document.getElementById('payRef');

    const confirmMsgEl = document.getElementById('confirmMsg');
    const confNameEl = document.getElementById('confName');
    const confEmailEl = document.getElementById('confEmail');
    const confPurposeEl = document.getElementById('confPurpose');
    const confPayRefEl = document.getElementById('confPayRef');
    const whatsappProofEl = document.getElementById('whatsappProof');

    let draft = {};

    function show(el){ el.classList.remove('step-hidden'); el.classList.add('step-visible'); }
    function hide(el){ el.classList.remove('step-visible'); el.classList.add('step-hidden'); }
    function setProgress(step){
      progBar1.style.width = step >= 1 ? '100%' : '0%';
      progBar2.style.width = step >= 2 ? '100%' : '0%';
      progBar3.style.width = step >= 3 ? '100%' : '0%';
    }

    function safeTrim(s){ return String(s || '').trim(); }
    function safeLower(s){ return safeTrim(s).toLowerCase(); }

    // Brand-only focus styling
    const inputs = document.querySelectorAll('input, select');
    inputs.forEach(el => {
      el.addEventListener('focus', () => {
        el.style.borderColor = 'rgba(133,204,255,0.95)';
        el.style.boxShadow = '0 0 0 4px rgba(133,204,255,0.18)';
      });
      el.addEventListener('blur', () => {
        el.style.borderColor = 'rgba(9,69,112,0.18)';
        el.style.boxShadow = 'none';
      });
    });

    setProgress(1);

    document.getElementById('s1Next').addEventListener('click', () => {
      if(!purposeEl.value) return alert('Select a payment purpose.');
      draft.purpose = purposeEl.value;
      show(step2); hide(step1); hide(step3); hide(confirmation); hide(recordView);
      setProgress(2);
      loadDraftToForm();
    });

    document.getElementById('s2Back').addEventListener('click', () => {
      show(step1); hide(step2); hide(step3); hide(confirmation); hide(recordView);
      setProgress(1);
    });

    document.getElementById('s2Next').addEventListener('click', () => {
      if(!safeTrim(nameEl.value)) return alert('Enter your full name.');
      if(!safeTrim(emailEl.value)) return alert('Enter your email address.');
      if(!safeTrim(emailEl.value).includes('@')) return alert('Enter a valid email address.');

      draft.name = safeTrim(nameEl.value);
      draft.email = safeTrim(emailEl.value);
      draft.phone = safeTrim(phoneEl.value);
      draft.note = safeTrim(noteEl.value);

      show(step3); hide(step1); hide(step2); hide(confirmation); hide(recordView);
      setProgress(3);
    });

    document.getElementById('s3Back').addEventListener('click', () => {
      show(step2); hide(step1); hide(step3); hide(confirmation); hide(recordView);
      setProgress(2);
    });

    // Save drafts
    document.getElementById('saveDraft1').addEventListener('click', () => {
      draft.purpose = purposeEl.value || draft.purpose;
      localStorage.setItem('himaayah_payment_draft', JSON.stringify(draft));
      alert('Draft saved locally.');
    });
    document.getElementById('saveDraft2').addEventListener('click', () => {
      draft.name = nameEl.value || draft.name;
      draft.email = emailEl.value || draft.email;
      draft.phone = phoneEl.value || draft.phone;
      draft.note = noteEl.value || draft.note;
      localStorage.setItem('himaayah_payment_draft', JSON.stringify(draft));
      alert('Draft saved locally.');
    });
    document.getElementById('saveDraft3').addEventListener('click', () => {
      draft.payRef = payRefEl.value || draft.payRef;
      localStorage.setItem('himaayah_payment_draft', JSON.stringify(draft));
      alert('Draft saved locally.');
    });

    // Copy account details
    document.getElementById('copyAccount').addEventListener('click', async () => {
      const text =
`Account Number: 9064540675
Bank: OPay
Account Name: Yusuf Abdulsamad Olohuntosin`;
      try {
        await navigator.clipboard.writeText(text);
        alert('Account details copied.');
      } catch(e){
        alert('Copy failed. Please copy manually.');
      }
    });

    // Confirm paid (truthful: submits claim, does NOT issue student ID instantly)
    document.getElementById('confirmPaid').addEventListener('click', async () => {
      draft.payRef = safeTrim(payRefEl.value);

      const claim = {
        id: 'claim_' + Math.random().toString(36).slice(2,9),
        purpose: draft.purpose || safeTrim(purposeEl.value),
        name: draft.name,
        email: draft.email,
        phone: draft.phone || "",
        note: draft.note || "",
        payRef: draft.payRef || "",
        status: "PENDING_CONFIRMATION",
        date: new Date().toLocaleString()
      };

      // Save local record
      const payments = JSON.parse(localStorage.getItem('himaayah_payments') || '[]');
      payments.push(claim);
      localStorage.setItem('himaayah_payments', JSON.stringify(payments));
      localStorage.setItem('himaayah_last_payment', JSON.stringify(claim));
      localStorage.setItem('himaayah_pending_claim', JSON.stringify(claim));

      // Optional: send to Google Form (if configured)
      let sent = false;
      if (GOOGLE_FORM_ENDPOINT) {
        try{
          const formData = new FormData();
          formData.append(ENTRY.purpose, claim.purpose);
          formData.append(ENTRY.name, claim.name);
          formData.append(ENTRY.email, claim.email);
          formData.append(ENTRY.phone, claim.phone);
          formData.append(ENTRY.note, claim.note);
          formData.append(ENTRY.payRef, claim.payRef);
          await fetch(GOOGLE_FORM_ENDPOINT, { method: "POST", mode: "no-cors", body: formData });
          sent = true;
        } catch(e){
          sent = false;
        }
      }

      // Populate confirmation UI
      confNameEl.textContent = claim.name || "-";
      confEmailEl.textContent = claim.email || "-";
      confPurposeEl.textContent = claim.purpose || "-";
      confPayRefEl.textContent = claim.payRef ? claim.payRef : "Not provided";

      confirmMsgEl.textContent = sent
        ? "JazaakAllahu khayran. Your submission has been received. Your Student ID will be issued after payment confirmation."
        : "JazaakAllahu khayran. Your submission has been saved on this device. If network is poor, please send proof on WhatsApp for faster confirmation.";

      // Build WhatsApp proof link
      const message =
`Assalaamu'alaykum admin.

I have paid for HIAIS.

Name: ${claim.name || "-"}
Email: ${claim.email || "-"}
Purpose: ${claim.purpose || "-"}
Payment Ref: ${claim.payRef || "Not provided"}

Kindly confirm and issue my Student ID. JazaakAllahu khayran.`;

      const waUrl = buildWhatsAppLink(ADMIN_WHATSAPP_NUMBER, message);
      whatsappProofEl.href = waUrl;

      // Move to confirmation step
      hide(step1); hide(step2); hide(step3); hide(recordView);
      show(confirmation);
      setProgress(3);
    });

    function buildWhatsAppLink(phoneNumber, text){
      const encoded = encodeURIComponent(text);
      // wa.me is reliable across devices
      return `https://wa.me/${phoneNumber}?text=${encoded}`;
    }

    // Copy details
    document.getElementById('copyDetails').addEventListener('click', async () => {
      const rec = JSON.parse(localStorage.getItem('himaayah_last_payment') || '{}');
      if(!rec.id) return alert('No record found.');
      const text =
`HIAIS Payment Claim
Name: ${rec.name || "-"}
Email: ${rec.email || "-"}
Purpose: ${rec.purpose || "-"}
Payment Ref: ${rec.payRef || "Not provided"}`;
      try{
        await navigator.clipboard.writeText(text);
        alert('Details copied.');
      } catch(e){
        alert('Copy failed. Please copy manually.');
      }
    });

    // View record
    document.getElementById('viewRecord').addEventListener('click', () => {
      const payments = JSON.parse(localStorage.getItem('himaayah_payments') || '[]');
      recordJSON.textContent = JSON.stringify(payments.slice(-10).reverse(), null, 2);

      hide(step1); hide(step2); hide(step3); hide(confirmation);
      show(recordView);
    });

    document.getElementById('closeRecord').addEventListener('click', () => {
      hide(recordView);
      show(confirmation);
    });

    // Draft restore
    function loadDraftToForm(){
      const raw = localStorage.getItem('himaayah_payment_draft');
      if(!raw) return;
      try {
        const d = JSON.parse(raw);
        if(d.purpose) purposeEl.value = d.purpose;
        if(d.name) nameEl.value = d.name;
        if(d.email) emailEl.value = d.email;
        if(d.phone) phoneEl.value = d.phone;
        if(d.note) noteEl.value = d.note;
        if(d.payRef) payRefEl.value = d.payRef;
      } catch(e){}
    }

    window.addEventListener('load', () => {
      const raw = localStorage.getItem('himaayah_payment_draft');
      if(raw) { try { draft = JSON.parse(raw); } catch(e){} }
      loadDraftToForm();
    });
  </script>

</body>
</html>
